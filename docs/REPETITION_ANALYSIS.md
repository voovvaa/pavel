# üîÑ –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π –¥–ª—è –ì–µ–π—Å–∞–Ω–¥—Ä–∞ –ö—É–ª–æ–≤–∏—á–∞

## üìã –û–±–∑–æ—Ä

–ì–µ–π—Å–∞–Ω–¥—Ä –ö—É–ª–æ–≤–∏—á —Ç–µ–ø–µ—Ä—å —É–º–µ–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –Ω–∏—Ö –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ - –æ—Ç –ª–µ–≥–∫–æ–≥–æ –Ω–∞–º–µ–∫–∞ –¥–æ –¥—Ä—É–∂–µ—Å–∫–æ–≥–æ "–ø–æ—à–µ–ª –Ω–∞—Ö—É–π", –∫–∞–∫ —ç—Ç–æ –¥–µ–ª–∞–ª –±—ã –∂–∏–≤–æ–π —á–µ–ª–æ–≤–µ–∫.

## üß† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞

### 1. –ê–ª–≥–æ—Ä–∏—Ç–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ö–æ–∂–µ—Å—Ç–∏
- **Levenshtein distance** - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É —Å—Ç—Ä–æ–∫–∞–º–∏
- **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤ similarity** - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è distance –≤ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å—Ö–æ–∂–µ—Å—Ç–∏ (0-1)
- **–ü–æ—Ä–æ–≥ —Å—Ö–æ–∂–µ—Å—Ç–∏**: 0.85 (85%) –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è "–ø–æ—Ö–æ–∂–∏—Ö" —Å–æ–æ–±—â–µ–Ω–∏–π

### 2. –ê–Ω–∞–ª–∏–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç **–ø–æ—Å–ª–µ–¥–Ω–∏–µ 15 —Å–æ–æ–±—â–µ–Ω–∏–π** –æ—Ç –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–¢–æ—á–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è** - –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏
- **–ü–æ—Ö–æ–∂–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è** - —Å—Ö–æ–∂–µ—Å—Ç—å > 85%
- **–ü–æ–¥—Å—á–µ—Ç –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π** - –º–∞–∫—Å–∏–º—É–º –∏–∑ —Ç–æ—á–Ω—ã—Ö –∏ –ø–æ—Ö–æ–∂–∏—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π

### 3. –£—Ä–æ–≤–Ω–∏ —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏—è

| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π | –£—Ä–æ–≤–µ–Ω—å | –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ì–µ–π—Å–∞–Ω–¥—Ä–∞ |
|----------------------|---------|-------------------|
| 1 —Ä–∞–∑ | `none` | –û–±—ã—á–Ω—ã–π –æ—Ç–≤–µ—Ç |
| 2-3 —Ä–∞–∑–∞ | `mild` | –ù–∞–º–µ–∫–∞–µ—Ç —á—Ç–æ —É–∂–µ –æ—Ç–≤–µ—á–∞–ª |
| 4-5 —Ä–∞–∑ | `moderate` | –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ |
| 6+ —Ä–∞–∑ | `high` | –ü–æ—Å—ã–ª–∞–µ—Ç –Ω–∞—Ö—É–π –ø–æ-–¥—Ä—É–∂–µ—Å–∫–∏ |

## üé≠ –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–∫—Ü–∏–π

### –õ–µ–≥–∫–æ–µ —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ (mild)
**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–≤—Ç–æ—Ä—è–µ—Ç 2-3 —Ä–∞–∑–∞:**
- "–Ø –∂–µ —Ç–æ–ª—å–∫–æ —á—Ç–æ –≥–æ–≤–æ—Ä–∏–ª"
- "–¢–∞ –∂–µ —Ñ–∏–≥–Ω—è —á—Ç–æ –∏ –º–∏–Ω—É—Ç—É –Ω–∞–∑–∞–¥"
- "–í–æ–ª–æ–¥—å, –ø–æ–≤—Ç–æ—Ä—è–µ—à—å—Å—è"

### –£–º–µ—Ä–µ–Ω–Ω–æ–µ —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ (moderate)
**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–≤—Ç–æ—Ä—è–µ—Ç 4-5 —Ä–∞–∑:**
- "–¢—ã —á–µ, –≥–ª—é—á–∏—à—å?"
- "–ë—Ä–æ, —Ç—ã –∫–∞–∫ —Å–ª–æ–º–∞–Ω–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∫–∞"
- "–ß–µ —Ç—ã –∑–∞—Ü–∏–∫–ª–∏–ª—Å—è?"

### –í—ã—Å–æ–∫–æ–µ —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ (high)
**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–≤—Ç–æ—Ä—è–µ—Ç 6+ —Ä–∞–∑:**
- "–û–π –∏–¥–∏—Ç–µ –Ω–∞—Ö—É–π"
- "–ß–µ —Ç—ã –¥–æ—Å—Ç–∞–µ—à—å?"
- "–í–æ–ª–æ–¥—å, —Ç—ã –æ—Ö—É–µ–ª?"
- "–°–∫–æ–ª—å–∫–æ –º–æ–∂–Ω–æ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ?"

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ú–µ—Ç–æ–¥—ã –≤ AIEngine:

```typescript
// –ê–Ω–∞–ª–∏–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
private analyzeRepetition(messageText: string, author: string, context: ChatContext): {
  isRepetition: boolean;
  repetitionCount: number;
  irritationLevel: 'none' | 'mild' | 'moderate' | 'high';
  shouldAdaptPrompt: boolean;
}

// –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ö–æ–∂–µ—Å—Ç–∏ —Å—Ç—Ä–æ–∫
private calculateSimilarity(str1: string, str2: string): number

// –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π Levenshtein distance
private levenshteinDistance(a: string, b: string): number
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ–º–ø—Ç–∞–º–∏:

#### –î–ª—è GPT-5 nano (–∫—Ä–∞—Ç–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏):
```
${author} –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è (3x). –ù–∞–º–µ–∫–Ω–∏ —á—Ç–æ —É–∂–µ –æ—Ç–≤–µ—á–∞–ª.
${author} –¥–æ—Å—Ç–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–∞–º–∏ (5x). –ü–æ–∫–∞–∂–∏ –ª–µ–≥–∫–æ–µ —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ.
${author} –∑–∞–¥–æ–ª–±–∞–ª –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è–º–∏ (7x). –ü–æ—à–ª–∏ –µ–≥–æ –Ω–∞—Ö—É–π –ø–æ-–¥—Ä—É–∂–µ—Å–∫–∏.
```

#### –î–ª—è –ø–æ–ª–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π (–¥–µ—Ç–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏):
```
–í–ù–ò–ú–ê–ù–ò–ï - –ü–û–í–¢–û–†–ï–ù–ò–Ø:
–í–æ–ª–æ–¥—è —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ 3 —Ä–∞–∑–∞. –ù–∞–º–µ–∫–Ω–∏ —á—Ç–æ —É–∂–µ –æ—Ç–≤–µ—á–∞–ª –Ω–µ–¥–∞–≤–Ω–æ.
–í–∞—Ä–∏–∞–Ω—Ç—ã: "–Ø –∂–µ —Ç–æ–ª—å–∫–æ —á—Ç–æ –≥–æ–≤–æ—Ä–∏–ª", "–¢–∞ –∂–µ —Ñ–∏–≥–Ω—è —á—Ç–æ –∏ –º–∏–Ω—É—Ç—É –Ω–∞–∑–∞–¥", "–í–æ–ª–æ–¥—å, –ø–æ–≤—Ç–æ—Ä—è–µ—à—å—Å—è".
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:
```bash
bun run test-repetition
```

### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:
1. **–ê–ª–≥–æ—Ä–∏—Ç–º —Å—Ö–æ–∂–µ—Å—Ç–∏** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å Levenshtein distance
2. **–ê–Ω–∞–ª–∏–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É—Ä–æ–≤–Ω–µ–π —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏—è
3. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤** - —Ä–µ–∞–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã AI —Å —É—á–µ—Ç–æ–º –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
- –õ–µ–≥–∫–∏–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è (2-3 —Ä–∞–∑–∞)
- –£–º–µ—Ä–µ–Ω–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è (4-5 —Ä–∞–∑)
- –í—ã—Å–æ–∫–∏–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è (6+ —Ä–∞–∑)

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π:
```
üîÑ –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ: 4x "–∫–∞–∫ –¥–µ–ª–∞..." –æ—Ç –í–æ–ª–æ–¥—è
üò§ –£—Ä–æ–≤–µ–Ω—å —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏—è: moderate
```

### –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
–ü—Ä–∏ `DEV_MODE=true` –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ:
- –ê–Ω–∞–ª–∏–∑–µ –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
- –í—ã—á–∏—Å–ª–µ–Ω–∏–∏ —Å—Ö–æ–∂–µ—Å—Ç–∏ —Å—Ç—Ä–æ–∫
- –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è AI

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –ü–æ—Ä–æ–≥–∏ –≤ –∫–æ–¥–µ (–º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å):
```typescript
// –ü–æ—Ä–æ–≥ —Å—Ö–æ–∂–µ—Å—Ç–∏ –¥–ª—è "–ø–æ—Ö–æ–∂–∏—Ö" —Å–æ–æ–±—â–µ–Ω–∏–π
const SIMILARITY_THRESHOLD = 0.85; // 85%

// –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
const MESSAGES_TO_ANALYZE = 15;

// –£—Ä–æ–≤–Ω–∏ —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏—è
const MILD_THRESHOLD = 2;     // 2-3 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
const MODERATE_THRESHOLD = 4; // 4-5 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π  
const HIGH_THRESHOLD = 6;     // 6+ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Å–∏—Å—Ç–µ–º—ã

### –ß–µ–ª–æ–≤–µ—á–Ω–æ—Å—Ç—å:
- **–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–µ–∞–∫—Ü–∏–∏** –Ω–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è, –∫–∞–∫ —É –∂–∏–≤–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞
- **–ì—Ä–∞–¥–∞—Ü–∏—è —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏—è** –æ—Ç –ª–µ–≥–∫–æ–π –∏—Ä–æ–Ω–∏–∏ –¥–æ –º–∞—Ç–∞
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞** –ì–µ–π—Å–∞–Ω–¥—Ä–∞ –ö—É–ª–æ–≤–∏—á–∞

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å:
- **Levenshtein distance** - –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º
- **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–æ—Ä–æ–≥–∏** —Å—Ö–æ–∂–µ—Å—Ç–∏ –∏ —É—Ä–æ–≤–Ω–µ–π —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏—è
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - –∞–Ω–∞–ª–∏–∑ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:
- **–†–∞–±–æ—Ç–∞–µ—Ç —Å –æ–±–µ–∏–º–∏ AI –º–æ–¥–µ–ª—è–º–∏** (nano –∏ –ø–æ–ª–Ω—ã–º–∏)
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏** (–ø–∞–º—è—Ç—å, —ç–º–æ—Ü–∏–∏)
- **–ù–µ –ª–æ–º–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**

## üîÆ –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ä–æ–≥–æ–≤** - —Ä–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ —Ç–µ—Ä–ø–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è** - —É—á–µ—Ç –≤–∞–∂–Ω–æ—Å—Ç–∏ —Ç–µ–º—ã –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏—è
3. **–í—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞–º—è—Ç—å** - —É—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è–º–∏
4. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π** - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–∞–º—ã—Ö "–ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ì–µ–π—Å–∞–Ω–¥—Ä –ö—É–ª–æ–≤–∏—á —Ç–µ–ø–µ—Ä—å —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —á–µ–ª–æ–≤–µ—á–Ω–æ –∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ! üé≠
